

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    <%- include("../../views/partials/admin/header") %>

<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Coupon Management</h1>
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="openCreateCouponModal()">
            <i class="fas fa-plus mr-2"></i>Create Coupon
        </button>
    </div>

        <!-- Search Section -->
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <div class="flex gap-4">
                <input type="text" id="searchInput" placeholder="Search coupons..." 
                       class="flex-1 px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <select class="px-4 py-2 border rounded">
                    <option value="all">All Status</option>
                    <option value="active">Active</option>
                    <option value="expired">Expired</option>
                </select>
            </div>
        </div>

        <!-- Coupons Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
          <table class="w-full">
              <thead class="bg-gray-800 text-white">
                  <tr>
                      <th class="px-4 py-3 text-left">No.</th>
                      <th class="px-4 py-3 text-left">Code</th>
                      <th class="px-4 py-3 text-left">Description</th>
                      <th class="px-4 py-3 text-right">Discount</th>
                      <th class="px-4 py-3 text-center">Min Purchase</th>
                      <th class="px-4 py-3 text-center">Expiry Date</th>
                      <th class="px-4 py-3 text-center">Status</th>
                      <th class="px-4 py-3 text-center">Actions</th>
                  </tr>
              </thead>
              <tbody>
                  <tr class="border-b hover:bg-gray-100">
                      <td class="px-4 py-3">1</td>
                      <td class="px-4 py-3">SUMMER2024</td>
                      <td class="px-4 py-3">Summer Special Discount</td>
                      <td class="px-4 py-3 text-right">20%</td>
                      <td class="px-4 py-3 text-center">₹1000</td>
                      <td class="px-4 py-3 text-center">31 May 2024</td>
                      <td class="px-4 py-3 text-center">
                          <span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">Active</span>
                      </td>
                      <td class="px-4 py-3 text-center">
                          <div class="flex justify-center space-x-3">
                              <button class="text-blue-500 hover:text-blue-700" title="Edit" 
                                      onclick="openEditCouponModal('SUMMER2024', 'Summer Special Discount', 'percentage', '20', '1000', '2024-05-31')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="text-red-500 hover:text-red-700" title="Delete" 
                                      onclick="return confirm('Are you sure you want to delete this coupon?')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                  </tr>
                    <tr class="border-b hover:bg-gray-100">
                        <td class="px-4 py-3">2</td>
                        <td class="px-4 py-3">WELCOME50</td>
                        <td class="px-4 py-3">New User Discount</td>
                        <td class="px-4 py-3 text-right">50%</td>
                        <td class="px-4 py-3 text-center">₹2000</td>
                        <td class="px-4 py-3 text-center">15 Apr 2024</td>
                        <td class="px-4 py-3 text-center">
                            <span class="px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">Active</span>
                        </td>
                        <td class="px-4 py-3 text-center">
                          <div class="flex justify-center space-x-3">
                              <button class="text-blue-500 hover:text-blue-700" title="Edit" 
                                      onclick="openEditCouponModal('SUMMER2024', 'Summer Special Discount', 'percentage', '20', '1000', '2024-05-31')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="text-red-500 hover:text-red-700" title="Delete" 
                                      onclick="return confirm('Are you sure you want to delete this coupon?')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                    </tr>
                    <tr class="border-b hover:bg-gray-100">
                        <td class="px-4 py-3">3</td>
                        <td class="px-4 py-3">FLASH500</td>
                        <td class="px-4 py-3">Flash Sale Discount</td>
                        <td class="px-4 py-3 text-right">₹500</td>
                        <td class="px-4 py-3 text-center">₹5000</td>
                        <td class="px-4 py-3 text-center">1 Mar 2024</td>
                        <td class="px-4 py-3 text-center">
                            <span class="px-2 py-1 rounded-full text-xs bg-red-100 text-red-800">Expired</span>
                        </td>
                        <td class="px-4 py-3 text-center">
                          <div class="flex justify-center space-x-3">
                              <button class="text-blue-500 hover:text-blue-700" title="Edit" 
                                      onclick="openEditCouponModal('SUMMER2024', 'Summer Special Discount', 'percentage', '20', '1000', '2024-05-31')">
                                  <i class="fas fa-edit"></i>
                              </button>
                              <button class="text-red-500 hover:text-red-700" title="Delete" 
                                      onclick="return confirm('Are you sure you want to delete this coupon?')">
                                  <i class="fas fa-trash"></i>
                              </button>
                          </div>
                      </td>
                    </tr>
                </tbody>
            </table>

            <!-- Pagination -->
            <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200">
                <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                    <div>
                        <p class="text-sm text-gray-700">
                            Showing
                            <span class="font-medium">1</span>
                            to
                            <span class="font-medium">3</span>
                            of
                            <span class="font-medium">3</span>
                            coupons
                        </p>
                    </div>
                    <div>
                        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                            <span class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400">
                                <span class="sr-only">Previous</span>
                                <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-blue-50 text-sm font-medium text-blue-600">
                                1
                            </span>
                            <span class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400">
                                <span class="sr-only">Next</span>
                                <i class="fas fa-chevron-right"></i>
                            </span>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Coupon Modal -->
    <div id="createCouponModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen">
            <div class="bg-white rounded-lg shadow-xl w-96 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Create New Coupon</h2>
                    <button onclick="closeCreateCouponModal()" class="text-gray-600 hover:text-gray-900">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form onsubmit="event.preventDefault(); closeCreateCouponModal();">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Coupon Code</label>
                            <input type="text" name="code" required
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea name="description" required
                                      class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Discount Type</label>
                            <select name="discountType" required
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <option value="percentage">Percentage</option>
                                <option value="fixed">Fixed Amount</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Discount Amount</label>
                            <input type="number" name="discountAmount" required
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Minimum Purchase Amount</label>
                            <input type="number" name="minPurchase" required
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Expiry Date</label>
                            <input type="date" name="expiryDate" required
                                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="flex justify-end space-x-3">
                            <button type="button" onclick="closeCreateCouponModal()"
                                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit"
                                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                                Create Coupon
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <div id="editCouponModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
      <div class="flex items-center justify-center min-h-screen">
          <div class="bg-white rounded-lg shadow-xl w-96 p-6">
              <div class="flex justify-between items-center mb-4">
                  <h2 class="text-xl font-bold">Edit Coupon</h2>
                  <button onclick="closeEditCouponModal()" class="text-gray-600 hover:text-gray-900">
                      <i class="fas fa-times"></i>
                  </button>
              </div>
              <form onsubmit="event.preventDefault(); closeEditCouponModal();">
                  <div class="space-y-4">
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Coupon Code</label>
                          <input type="text" id="editCode" name="code" required
                                 class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Description</label>
                          <textarea id="editDescription" name="description" required
                                    class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Discount Type</label>
                          <select id="editDiscountType" name="discountType" required
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                              <option value="percentage">Percentage</option>
                              <option value="fixed">Fixed Amount</option>
                          </select>
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Discount Amount</label>
                          <input type="number" id="editDiscountAmount" name="discountAmount" required
                                 class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Minimum Purchase Amount</label>
                          <input type="number" id="editMinPurchase" name="minPurchase" required
                                 class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-700">Expiry Date</label>
                          <input type="date" id="editExpiryDate" name="expiryDate" required
                                 class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                      </div>
                      <div class="flex justify-end space-x-3">
                          <button type="button" onclick="closeEditCouponModal()"
                                  class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                              Cancel
                          </button>
                          <button type="submit"
                                  class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                              Update Coupon
                          </button>
                      </div>
                  </div>
              </form>
          </div>
      </div>
  </div>



    <script>
        // Modal functions
        function openCreateCouponModal() {
            document.getElementById('createCouponModal').classList.remove('hidden');
        }

        function closeCreateCouponModal() {
            document.getElementById('createCouponModal').classList.add('hidden');
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const statusSelect = document.querySelector('select');
            const tbody = document.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');

            function filterCoupons() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedStatus = statusSelect.value.toLowerCase();

                rows.forEach(row => {
                    const code = row.children[1].textContent.toLowerCase();
                    const description = row.children[2].textContent.toLowerCase();
                    const status = row.children[6].textContent.toLowerCase().trim();

                    const matchesSearch = code.includes(searchTerm) || description.includes(searchTerm);
                    const matchesStatus = selectedStatus === 'all' || status === selectedStatus;

                    row.style.display = matchesSearch && matchesStatus ? '' : 'none';
                });
            }

            searchInput.addEventListener('input', filterCoupons);
            statusSelect.addEventListener('change', filterCoupons);
        });

        function openEditCouponModal(code, description, discountType, discountAmount, minPurchase, expiryDate) {
            document.getElementById('editCode').value = code;
            document.getElementById('editDescription').value = description;
            document.getElementById('editDiscountType').value = discountType;
            document.getElementById('editDiscountAmount').value = discountAmount;
            document.getElementById('editMinPurchase').value = minPurchase;
            document.getElementById('editExpiryDate').value = expiryDate;
            document.getElementById('editCouponModal').classList.remove('hidden');
        }

        function closeEditCouponModal() {
            document.getElementById('editCouponModal').classList.add('hidden');
        }

        // Previous search functionality remains the same
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const statusSelect = document.querySelector('select');
            const tbody = document.querySelector('tbody');
            const rows = tbody.querySelectorAll('tr');

            function filterCoupons() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedStatus = statusSelect.value.toLowerCase();

                rows.forEach(row => {
                    const code = row.children[1].textContent.toLowerCase();
                    const description = row.children[2].textContent.toLowerCase();
                    const status = row.children[6].textContent.toLowerCase().trim();

                    const matchesSearch = code.includes(searchTerm) || description.includes(searchTerm);
                    const matchesStatus = selectedStatus === 'all' || status === selectedStatus;

                    row.style.display = matchesSearch && matchesStatus ? '' : 'none';
                });
            }

            searchInput.addEventListener('input', filterCoupons);
            statusSelect.addEventListener('change', filterCoupons);
        });

        // Modal functions for create
        function openCreateCouponModal() {
            document.getElementById('createCouponModal').classList.remove('hidden');
        }

        function closeCreateCouponModal() {
            document.getElementById('createCouponModal').classList.add('hidden');
        }
    </script>
<%- include("../../views/partials/admin/footer") %>