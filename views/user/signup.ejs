<%- include("../../views/partials/user/header") %>

<style>
  .container {
    max-width: 1000px;
    margin: 50px auto;
  }
  
  .signup-container {
    display: flex;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    border-radius: 12px;
    overflow: hidden;
    background: #fff;
  }
  
  .image-container {
    flex: 1;
    background-color: #f9ecbc;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 30px;
  }
  
  .dental-image {
    max-width: 100%;
    max-height: 350px;
    object-fit: cover;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  
  .image-text {
    margin-top: 30px;
    text-align: center;
  }
  
  .image-heading {
    color: #2c3e50;
    font-size: 24px;
    margin-bottom: 15px;
  }
  
  .image-description {
    color: #7f8c8d;
    font-size: 16px;
    line-height: 1.6;
  }
  
  .form-container {
    flex: 1;
    padding: 40px;
  }
  
  .signup-form {
    width: 100%;
    margin: 0;
    padding: 0;
    box-shadow: none;
  }
  
  .form-title {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 25px;
    font-size: 28px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #34495e;
    font-weight: 500;
  }
  
  .form-control {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
    transition: border-color 0.3s ease;
  }
  
  .form-control:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.25);
  }
  
  .error-message {
    color: #e74c3c;
    font-size: 14px;
    margin-top: 5px;
    display: none;
  }
  
  .password-input-wrapper {
    position: relative;
  }
  
  .toggle-password {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #7f8c8d;
  }
  
  .password-requirements {
    font-size: 12px;
    color: #7f8c8d;
    margin-top: 5px;
  }
  
  
  .submit-btn:disabled {
    background: #bdc3c7;
    box-shadow: none;
    cursor: not-allowed;
  }
  
  .form-footer {
    margin-top: 25px;
    text-align: center;
  }
  
  .form-footer p {
    color: #7f8c8d;
    margin-bottom: 0;
  }
  
  .form-footer a {
    color: #242424;
    text-decoration: none;
    font-weight: 600;
  }
  
  .alert {
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid transparent;
    border-radius: 8px;
  }
  
  .alert-danger {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
  }
  
  /* Responsive styles */
  @media (max-width: 900px) {
    .container {
      margin: 30px auto;
      max-width: 90%;
    }
  }
  
  @media (max-width: 768px) {
    .signup-container {
      flex-direction: column;
    }
    
    .image-container {
      padding: 20px;
    }
    
    .dental-image {
      max-height: 200px;
    }
    
    .image-heading {
      font-size: 22px;
    }
    
    .form-container {
      padding: 25px;
    }
    
    .form-title {
      font-size: 24px;
      margin-bottom: 20px;
    }
  }
  
  @media (max-width: 480px) {
    .container {
      margin: 15px auto;
      max-width: 95%;
    }
    
    .signup-container {
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    
    .image-container {
      padding: 15px;
    }
    
    .dental-image {
      max-height: 150px;
    }
    
    .image-heading {
      font-size: 20px;
      margin-bottom: 10px;
    }
    
    .image-description {
      font-size: 14px;
    }
    
    .form-container {
      padding: 20px 15px;
    }
    
    .form-title {
      font-size: 22px;
      margin-bottom: 15px;
    }
    
    .form-control {
      padding: 10px;
      font-size: 14px;
    }
    
    .submit-btn {
      padding: 12px;
      font-size: 15px;
    }
  }
</style>

<div class="container">
  <div class="signup-container">
    <!-- Dental Image Section (Left Side) -->
    <div class="image-container">
      <img src="/img/signuppageimg.jpg" alt="Dental Products" class="dental-image">
      <div class="image-text">
        <h3 class="image-heading">Your Dental Shop</h3>
        <p class="image-description">Quality dental products delivered to your doorstep. Shop professional-grade supplies for your practice or home care.</p>
      </div>
    </div>

    <div class="form-container">
      <form class="signup-form" id="signupForm" method="post" action="/signup">
        <h2 class="form-title">Create an Account</h2>
        
        <% if (typeof message !== 'undefined') { %>
            <div class="alert alert-danger" role="alert">
                <%= message %>
            </div>
        <% } %>
        
        <div class="form-group">
            <label for="fullName">Full Name</label>
            <input type="text" name="name" id="fullName" class="form-control" minlength="3">
            <div id="error1" class="error-message"></div>
        </div>
  
        <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" name="email" id="email" class="form-control">
            <div id="error2" class="error-message"></div>
        </div>
  
        <div class="form-group">
            <label for="phone">Mobile Number</label>
            <input type="tel" id="phone" name="phone" class="form-control" placeholder="Enter 10 digit mobile number" pattern="[0-9]{10}">
            <div id="error3" class="error-message"></div>
        </div>
  
        <div class="form-group">
            <label for="password">Password</label>
            <div class="password-input-wrapper">
                <input type="password" name="password" id="password" class="form-control" minlength="8">
                <i class="fas fa-eye-slash toggle-password" onclick="togglePasswordVisibility('password')"></i>
            </div>
            <div id="error4" class="error-message"></div>
            <div class="password-requirements">
                Password must contain at least 8 characters, including uppercase, lowercase, number and special character
            </div>
        </div>
  
        <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <div class="password-input-wrapper">
                <input type="password" name="confirmPassword" id="confirmPassword" class="form-control">
                <i class="fas fa-eye-slash toggle-password" onclick="togglePasswordVisibility('confirmPassword')"></i>
            </div>
            <div id="error5" class="error-message"></div>
        </div>
  
        <button type="submit" class="submit-btn" id="submitBtn">
            <span class="btn-text">Sign Up</span>
            <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
        </button>

        <div class="form-footer">
            <p>Already have an account? <a href="/signin">Sign In</a></p>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
const nameid = document.getElementById("fullName");
const emailid = document.getElementById("email");
const phoneid = document.getElementById("phone");
const passwordid = document.getElementById("password");
const confirmPasswordid = document.getElementById("confirmPassword");
const submitBtn = document.getElementById("submitBtn");

const error1 = document.getElementById("error1");
const error2 = document.getElementById("error2");
const error3 = document.getElementById("error3");
const error4 = document.getElementById("error4");
const error5 = document.getElementById("error5");

const signupform = document.getElementById("signupForm");

function showError(element, message) {
    element.style.display = "block";
    element.innerHTML = message;
    element.closest('.form-group').querySelector('input').classList.add('is-invalid');
}

function clearError(element) {
    element.style.display = "none";
    element.innerHTML = "";
    element.closest('.form-group').querySelector('input').classList.remove('is-invalid');
}

function nameValidateChecking() {
    const nameval = nameid.value.trim();
    const namepattern = /^[A-Za-z]+(?: [A-Za-z]+)*$/;

    if (nameval === "") {
        showError(error1, "Please enter your name");
        return false;
    } else if (!namepattern.test(nameval)) {
        showError(error1, "Name can only contain alphabets and spaces");
        return false;
    } else {
        clearError(error1);
        return true;
    }
}

function emailValidateChecking() {
    const emailval = emailid.value.trim();
    const emailpattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

    if (emailval === "") {
        showError(error2, "Please enter your email");
        return false;
    } else if (!emailpattern.test(emailval)) {
        showError(error2, "Please enter a valid email address");
        return false;
    } else {
        clearError(error2);
        return true;
    }
}

function phoneValidateChecking() {
    const phoneval = phoneid.value.trim();
    const phonepattern = /^[0-9]{10}$/;

    if (phoneval === "") {
        showError(error3, "Please enter your phone number");
        return false;
    } else if (!phonepattern.test(phoneval)) {
        showError(error3, "Please enter a valid 10-digit phone number");
        return false;
    } else {
        clearError(error3);
        return true;
    }
}

function passValidateChecking() {
    const passval = passwordid.value.trim();
    const cpassval = confirmPasswordid.value.trim();
    const passwordpattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    let isValid = true;

    if (passval === "") {
        showError(error4, "Please enter a password");
        isValid = false;
    } else if (!passwordpattern.test(passval)) {
        showError(error4, "Password must contain at least 8 characters, including uppercase, lowercase, number and special character");
        isValid = false;
    } else {
        clearError(error4);
    }

    if (cpassval === "") {
        showError(error5, "Please confirm your password");
        isValid = false;
    } else if (cpassval !== passval) {
        showError(error5, "Passwords do not match");
        isValid = false;
    } else {
        clearError(error5);
    }

    return isValid;
}

function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    const icon = input.nextElementSibling;
    
    if (input.type === "password") {
        input.type = "text";
        icon.classList.remove("fa-eye-slash");
        icon.classList.add("fa-eye");
    } else {
        input.type = "password";
        icon.classList.remove("fa-eye");
        icon.classList.add("fa-eye-slash");
    }
}

// Real-time validation
nameid.addEventListener("input", nameValidateChecking);
emailid.addEventListener("input", emailValidateChecking);
phoneid.addEventListener("input", phoneValidateChecking);
passwordid.addEventListener("input", passValidateChecking);
confirmPasswordid.addEventListener("input", passValidateChecking);

signupform.addEventListener("submit", (e) => {
    e.preventDefault();
    
    const isNameValid = nameValidateChecking();
    const isEmailValid = emailValidateChecking();
    const isPhoneValid = phoneValidateChecking();
    const isPasswordValid = passValidateChecking();

    if (isNameValid && isEmailValid && isPhoneValid && isPasswordValid) {
        // Show loading state
        submitBtn.disabled = true;
        submitBtn.querySelector('.btn-text').style.display = 'none';
        submitBtn.querySelector('.spinner-border').classList.remove('d-none');
        
        // Submit the form
        signupform.submit();
    }
});

document.addEventListener('DOMContentLoaded', () => {
    const alertElement = document.querySelector('.alert');
    if (alertElement) {
        setTimeout(() => {
            alertElement.style.opacity = '0';
            alertElement.style.transition = 'opacity 0.3s ease';
            setTimeout(() => alertElement.remove(), 300);
        }, 5000);
    }
});
</script>

<%- include("../../views/partials/user/footer") %>